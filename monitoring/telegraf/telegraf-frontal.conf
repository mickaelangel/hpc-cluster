# Configuration Telegraf pour nœuds frontaux HPC
# Output: Prometheus exposition format (port 9273)
# Inputs: CPU, Memory, Disk, Network, Processes, Kernel, Slurm (optionnel)

[global_tags]
  cluster = "hpc-demo"
  role = "frontal"
  environment = "production"

[agent]
  interval = "15s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = ""
  hostname = ""
  omit_hostname = false

# ============================================
# INPUTS - COLLECTE DE MÉTRIQUES
# ============================================

# CPU Metrics
[[inputs.cpu]]
  percpu = true
  totalcpu = true
  collect_cpu_time = false
  report_active = false

# Memory Metrics
[[inputs.mem]]
  # Collecte automatique des métriques mémoire

# Disk Metrics
[[inputs.disk]]
  ignore_fs = ["tmpfs", "devtmpfs", "devfs", "iso9660", "overlay", "aufs", "squashfs"]

# Disk I/O Metrics
[[inputs.diskio]]
  # Collecte automatique des métriques I/O disque

# Network Metrics
[[inputs.net]]
  # Collecte automatique des métriques réseau

# Process Metrics
[[inputs.processes]]
  # Collecte automatique des métriques processus

# Kernel Metrics
[[inputs.kernel]]
  # Collecte automatique des métriques kernel

# System Load
[[inputs.system]]
  # Collecte automatique des métriques système (load, uptime)

# Slurm Metrics (si SlurmCTLD est disponible)
# Décommenter si Slurm est installé et configuré
# [[inputs.exec]]
#   commands = ["sinfo -o '%P|%a|%l|%D|%t|%N|%C' -h"]
#   timeout = "5s"
#   data_format = "influx"
#   name_override = "slurm_partition_info"
#   [inputs.exec.tags]
#     cluster = "hpc-demo"
#     role = "frontal"

# [[inputs.exec]]
#   commands = ["squeue -h -o '%i|%j|%u|%t|%M|%l|%D|%C|%m|%N'"]
#   timeout = "5s"
#   data_format = "influx"
#   name_override = "slurm_job_info"
#   [inputs.exec.tags]
#     cluster = "hpc-demo"
#     role = "frontal"

# ============================================
# OUTPUTS - EXPOSITION DES MÉTRIQUES
# ============================================

# Prometheus Exposition Format (port 9273)
[[outputs.prometheus_client]]
  listen = ":9273"
  metric_version = 2
  expiration_interval = "60s"
  path = "/metrics"
  collectors_exclude = ["gocollector", "process"]

# ============================================
# PROCESSORS (optionnel)
# ============================================

# Ajout de tags supplémentaires si nécessaire
# [[processors.tagoverride]]
#   order = 1
